@model POE_Project.Models.Claim
@{
    ViewData["Title"] = "Lecturer - Submit Claim";
}

<div class="card p-4 mt-3">
    <h3>Submit Monthly Claim</h3>

    @if (TempData["Message"] != null)
    {
        <div class="alert alert-success">@TempData["Message"]</div>
    }

    @if (!ViewData.ModelState.IsValid)
    {
        <div class="alert alert-danger">
            <ul>
                @foreach (var error in ViewData.ModelState.Values.SelectMany(v => v.Errors))
                {
                    <li>@error.ErrorMessage</li>
                }
            </ul>
        </div>
    }

    <form asp-action="Lecturer" method="post" enctype="multipart/form-data" id="claimForm" novalidate>
        @Html.AntiForgeryToken()

        <!-- Your existing form fields -->
        <div class="mb-3">
            <label for="HoursWorked" class="form-label">Hours Worked</label>
            <input asp-for="HoursWorked" class="form-control" id="HoursWorked" type="number" step="0.01" min="0" required />
            <span asp-validation-for="HoursWorked" class="text-danger"></span>
        </div>

        <div class="mb-3">
            <label for="HourlyRate" class="form-label">Hourly Rate</label>
            <input asp-for="HourlyRate" class="form-control" id="HourlyRate" type="number" step="0.01" min="0" required />
            <span asp-validation-for="HourlyRate" class="text-danger"></span>
        </div>

        <div class="mb-3">
            <label for="TotalAmount" class="form-label">Total Amount</label>
            <input id="TotalAmount" class="form-control" type="text" readonly />
        </div>

        <div class="mb-3">
            <label for="Notes" class="form-label">Notes</label>
            <textarea asp-for="Notes" class="form-control" id="Notes" rows="3"></textarea>
        </div>

        <div class="mb-3">
            <label for="fileUpload" class="form-label">Upload supporting documents</label>
            <input id="fileUpload" name="files" type="file" class="form-control" multiple
                   accept=".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png" />
            <small id="fileHelp" class="form-text text-muted">You can select multiple files</small>
            <div id="fileList" class="mt-2"></div>
        </div>

        <button id="submitBtn" type="submit" class="btn btn-primary">Submit Claim</button>
    </form>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }

    <script>
        // Your JavaScript code here
        (function () {
            function fmt(v) {
                return Number(Math.round(v * 100) / 100).toFixed(2);
            }

            function recalc() {
                var hours = parseFloat($('#HoursWorked').val());
                var rate = parseFloat($('#HourlyRate').val());
                if (!isFinite(hours) || hours < 0) hours = 0;
                if (!isFinite(rate) || rate < 0) rate = 0;
                var total = hours * rate;
                $('#TotalAmount').val('R ' + fmt(total));
            }

            function updateFileList() {
                var files = $('#fileUpload')[0].files;
                var fileList = $('#fileList');
                fileList.empty();

                if (files.length > 0) {
                    fileList.append('<strong>Selected files:</strong>');
                    var list = $('<ul class="mb-0 mt-1"></ul>');
                    for (var i = 0; i < files.length; i++) {
                        var file = files[i];
                        var size = (file.size / (1024 * 1024)).toFixed(2);
                        list.append('<li>' + file.name + ' (' + size + ' MB)</li>');
                    }
                    fileList.append(list);
                }
            }

            $('#HoursWorked, #HourlyRate').on('input change', recalc);
            $('#fileUpload').on('change', updateFileList);

            $(document).ready(function () {
                recalc();
                updateFileList();
            });
        })();
    </script>
}